<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Lotsemagazin Analyse</title>
<style>
body{
    font-family: Arial, sans-serif;
    background:#f0f0f0;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    margin:0;
}
.box{
    background:white;
    padding:30px 40px;
    border-radius:12px;
    box-shadow:0 0 10px rgba(0,0,0,0.1);
    max-width:500px;
    text-align:center;
}
input, button, textarea, select{
    padding:12px;
    font-size:16px;
    margin-top:10px;
    width:80%;
}
textarea{
    resize:none;
    height:120px;
}
button{
    background:#007bff;
    color:white;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
#status{
    margin-top:20px;
    font-size:15px;
    color:green;
}
label{
    display:flex;
    align-items:center;
    justify-content:center;
    gap:10px;
    font-size:14px;
}
</style>
</head>
<body>

<div class="box">

<h2>Vielen Dank fÃ¼r die UnterstÃ¼tzung</h2>
<p><strong>der Ersteller des Lotsemagazin</strong></p>

<hr>

<p>Lotsemagazin â€“ Standortanalyse</p>

<input type="text" id="name" placeholder="Dein Name (freiwillig)">

<!-- Feedback zuerst -->
<label for="feedback">
Dein Feedback (obligatorisch):
<select id="feedback">
    <option value="">Bitte wÃ¤hlen</option>
    <option value="ğŸ˜">ğŸ˜ Sehr gut</option>
    <option value="ğŸ˜Š">ğŸ˜Š Gut</option>
    <option value="ğŸ˜">ğŸ˜ Neutral</option>
    <option value="ğŸ˜•">ğŸ˜• KÃ¶nnte besser sein</option>
    <option value="ğŸ˜">ğŸ˜ Schlecht</option>
    <option value="ğŸ˜¡">ğŸ˜¡ Sehr schlecht</option>
</select>
</label>

<!-- AGB danach -->
<textarea readonly>
AGB / DatenschutzerklÃ¤rung:

- Mit Klick auf â€Analyse sendenâ€œ erklÃ¤rst du dich einverstanden,
  dass dein Name, Feedback, Standort und IP-Adresse fÃ¼r das Lotsemagazin verwendet werden.
- Die Daten werden ausschlieÃŸlich fÃ¼r das Lotsemagazin genutzt.
- Teilnahme ist freiwillig.
</textarea>

<label>
<input type="checkbox" id="agb">
Ich akzeptiere die AGB / DatenschutzerklÃ¤rung
</label>

<button onclick="sendAnalyse()">Analyse senden</button>

<div id="status"></div>

</div>

<script>
async function sendAnalyse() {
    const name = document.getElementById("name").value || "Anonym";
    const agbChecked = document.getElementById("agb").checked;
    const feedback = document.getElementById("feedback").value;

    if(feedback === ""){
        document.getElementById("status").innerText = "Bitte wÃ¤hle ein Feedback-Emoji aus.";
        return;
    }

    if(!agbChecked){
        document.getElementById("status").innerText = "Bitte akzeptiere die AGB / DatenschutzerklÃ¤rung.";
        return;
    }

    if(!navigator.geolocation){
        document.getElementById("status").innerText = "Geolocation wird nicht unterstÃ¼tzt.";
        return;
    }

    document.getElementById("status").innerText = "Analyse wird vorbereitetâ€¦";

    navigator.geolocation.getCurrentPosition(async pos => {
        const lat = pos.coords.latitude.toFixed(6);
        const lon = pos.coords.longitude.toFixed(6);
        const acc = pos.coords.accuracy;
        const time = new Date().toLocaleString();

        // IP-Adresse Ã¼ber Ã¶ffentliche API abrufen
        let ip = "Unbekannt";
        try {
            const res = await fetch('https://api.ipify.org?format=json');
            const data = await res.json();
            ip = data.ip;
        } catch (e) {
            console.log("IP konnte nicht ermittelt werden.");
        }

        const body = `
Lotsemagazin Standortanalyse

Name: ${name}
Feedback: ${feedback}
IP-Adresse: ${ip}

Ort:
Breitengrad: ${lat}
LÃ¤ngengrad: ${lon}
Genauigkeit: Â±${acc} Meter
Zeit: ${time}

Google Maps:
https://www.google.com/maps?q=${lat},${lon}

Analyse:
Teilnehmer hat freiwillig Standortdaten fÃ¼r das Lotsemagazin bereitgestellt.
        `;

        const mailtoLink = "mailto:mschoepfer@lotsebasel.onmicrosoft.com" +
                           "?subject=Lotsemagazin Standortanalyse" +
                           "&body=" + encodeURIComponent(body);

        window.location.href = mailtoLink;
        document.getElementById("status").innerText = "Analyse wird im E-Mail-Programm vorbereitet âœ”ï¸";

    }, () => {
        document.getElementById("status").innerText = "Standortfreigabe abgelehnt.";
    });
}
</script>

</body>
</html>
